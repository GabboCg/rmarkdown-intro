---
title: "R Markdown"
subtitle: "Un enfoque a la Investigación Reproducible"
author: "Gabriel Cabrera G."
date: "`r Sys.Date()`"
output:
  xaringan::moon_reader:
    css: ["default", "rladies", "rladies-fonts"]
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      ratio: '16:9'
      countIncrementalSlides: false
    includes:
      in_header: header.html
---

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(tidy = FALSE, eval = FALSE)
```

class: inverse, center, middle

# Mantenerse en contacto

<a href="mailto:gcabrerag@fen.uchile.cl"><i class="fa fa-paper-plane fa-fw"></i>&nbsp; gcabrerag@fen.uchile.cl</a><br>
<a href="https://gcabrerag.netlify.com/"><i class="fa fa-link fa-fw"></i>&nbsp; gcabrerag.rbind.io</a><br>
<a href="https://twitter.com/GaboC_g"><i class="fa fa-twitter fa-fw"></i>&nbsp; @GaboC_g</a><br>
<a href="http://github.com/GaboC_g"><i class="fa fa-github fa-fw"></i>&nbsp; @GaboC_g</a><br>
<a href="http://pregrado.fen.uchile.cl/"><i class="fa fa-map-marker fa-fw"></i>&nbsp; Facultad de Economía & Negocios, Universidad de Chile </a>

---

# Objetivo de la ayudantía

* Aprender R Markdown (R + Pandoc).
* Entender su capacidad para la investigación reproducible.
* Conocer su versatilidad y real potencial.

<br>

>“It is a capital mistake to theorize before one has data.” 
>
>--- Sherlock Holmes, *A Study in Scarlett* (Arthur Conan Doyle).

<br>

<center>
<iframe src="https://giphy.com/embed/3ohuAxV0DfcLTxVh6w" width="480" height="208" frameBorder="0" class="giphy-embed" allowFullScreen></iframe><p><a href="https://giphy.com/gifs/starwars-star-wars-episode-2-3ohuAxV0DfcLTxVh6w"></a></p>
</center>

---

# R Markdown: Una herramienta para la vida 

Una herramienta muy útil de Rstudio es el poder utilizar R Markdown por medio de knitr. Estas librerías vienen a complementar el tidyverse <sup>1</sup>  workflow.  


<center>
<img src="https://ismayc.github.io/moderndiver-book/images/tidy1.png">
</center>

.footnote[
[1] Librería que la da sentido al [Data Science](http://r4ds.had.co.nz/) con R actualmente
]

---

# R Markdown: knit

El botón `knit` (barra superior en Rstudio) es aquel que permite operar directamente con la librería `knitr`. Esta última fue diseñada basandose en la idea de "Literate Programming" usada por [Donald Knuth](https://es.wikipedia.org/wiki/Donald_Knuth) (creador del sistema de tipografía TeX<sup>2</sup>). Cuando `knitr` compila un documento, extrae un `chunk` y lo ejecuta, de manera que el proceso completo es: 


![processRStudio.png](http://www.geo.uzh.ch/microsite/reproducible_research/post/rr-r-publication/img/processRStudio.png)


.footnote[
[2] Larga vida a knuth!!!!
]

---

# R Markdown: un poco de información

Acá lo más importante son Markdown y Pandoc:

* Markdown: Es un lenguaje de marcado pero ligero (como si fuese sencillo, plain text), creado por [John Gruber](https://en.wikipedia.org/wiki/John_Gruber) y  con participación de [Aaron Swartz](https://www.youtube.com/watch?v=9vz06QO3UkQ).

* Pandoc: Es un convertidor universal de documentos, con la habilidad de convertir desde multiples formatos (Markdown, reStructuredText, textile, HTML, DocBook, Microsoft Word docx, LibreOffice ODT, EPUB y muchos más). Por eso en la comunidad se dice que pandoc es la navaja suiza de los formatos, se instala en conjunt con RStudio  

<center>
<img src="https://www.rstudio.com/wp-content/uploads/2014/04/rmarkdown-200x232.png">
</center>

---
class: inverse, center, middle

# Manos a la obra


---

# Nuestro Primer Documento R Markdown: Shortcut 

La manera usual de compilar en R Markdown es dandole click al boton `knit` o con el shortcut `Ctrl + Shift + K` (`CMD + Shift + k` en macOS). Atrás de todo esto, RStudio llama la función `rmarkdown::render()`. Veamos el ejemplo que por default viene con RStudio.

<center>
<iframe src="https://giphy.com/embed/5VKbvrjxpVJCM" width="480" height="384" frameBorder="0" class="giphy-embed" allowFullScreen></iframe><p><a href="https://giphy.com/gifs/5VKbvrjxpVJCM"></a></p>
</center>

---

# Nuestro Primer Documento R Markdown: YAML

YAML se define como un formato de serialización (proceso de codificación de un objeto en un medio de almacenamiento, en este caso metadata), El encabezado YAML es un conjunto de pares llave:valor al comienzo de tu archivo. Comienza y termina elencabezado con tres rayas (- - -), por ejemplo:

```r
---
title: "Mi primer R Markdown"
author: "Gabriel Cabrera"
date: "5 de agosto de 2018"
output: pdf_document
---
``` 

Posterior a `---` comenzamos a escribir nuestro documento. 

<center>
<iframe src="https://giphy.com/embed/HoffxyN8ghVuw" width="380" height="175" frameBorder="0" class="giphy-embed" allowFullScreen></iframe><p><a href="https://giphy.com/gifs/love-mini-hanger-HoffxyN8ghVuw"></a></p>
</center>

---

# R Markdown: Inline Formating 

Los siguientes son syntaxis de markdown, que son validas algunas con asterisco o guión bajo:

* Para **negrita** es `**texto**` o `__texto__`.
* Para *itálica* es  `*texto*` o `_texto_ `.
* Texto con ~ realiza un subíndice, `H~2~O~2~` y ^ un supraíndice. 
* Para agregar un link `[text](link)`.
* Para insertar imagen, `![imagen con extensión](/directorio/imagen con extensión)`

<center>
<iframe src="https://giphy.com/embed/OK27wINdQS5YQ" width="380" height="238" frameBorder="0" class="giphy-embed" allowFullScreen></iframe><p><a href="https://giphy.com/gifs/mind-seinfeild-OK27wINdQS5YQ"></a></p>
</center>

---

## R Markdown: Block level Element

1. Sección, Subsección y subsubsección:

```r
# First-level header
## Second-level header
### Third-level header
```
Con {-} se esconde el número.

2. Listas 

Listas no enumeradas comienzan con `*`, `-` o `+`, si se quiere crear una sublista se debe seguir **la regla de los cuatro espacios** (tener mucho ojo con esta regla, es muy util y nos puede ahorrar varios dolores de cabeza, sobre todo en el YAML). Por ejemplo:

.pull-left[
* unordered list
* item 2
    + sub-item 1
    + sub-item 2
]


.pull-right[
1. ordered list
2. item 2
    + sub-item 1
    + sub-item 2 
]
---

# R Markdown: Blockquotes:

A mi me gustan las citas, a quien no?..

```r
> "I thoroughly disapprove of duels. If a man should challenge me,
   I would take him kindly and forgivingly by the hand and lead him
   to a quiet place and kill him."
>
> --- Mark Twain
``` 

lo anterior genera:

> "I thoroughly disapprove of duels. If a man should challenge me,
I would take him kindly and forgivingly by the hand and lead him
to a quiet place and kill him."
>
> --- Mark Twain

Destaca más en HTML que en pdf usando $La\TeX$.

---

# R Markdown: Expresiones Mathematicas 

Para realizarlas *inline* , se realiza con `$f(k) = {n \choose k} p^{k} (1-p)^{n-k}$`, dando resultado $f(k) = {n \choose k} p^{k} (1-p)^{n-k}$. SI queremos que tenga un `display` usamos doble  `$$` 

$$ 
f(k) = {n \choose
k} p^{k} (1-p)^{n-k}
$$

Lo genial es que desde Rstudio podremos ver el **outcome**. Finalmente se puede usar "ambiente" matemático.

```r
$$
\Theta = \begin{pmatrix}\alpha & \beta\\
\gamma & \delta
\end{pmatrix}
$$
```
```r
$$
\begin{vmatrix}a & b\\
c & d
\end{vmatrix}=ad-bc
$$
```

En Html se usa [Mathjax](https://www.mathjax.org/) en la compilación y no una distribución $\TeX$.

---

# R code chunks & inline R code

Un *chunk* no es más que un trozo de código. Se puede hacer a "mano", pero siempre hay un atajo, en este caso `Ctrl + Alt + I` (windows/Linux) y `Cmd + Option + I` en macOS. Hay muchas cosas que podemos hacer en un *chunk*: producir output de texto, tablas (`kable`) o gráficos, estos son controlados dentro de `{r}`, por ejemplo podemos setear que se esconda el texto usando la opción del chunk `results = "hide"` o que la figura tengo un "alto" de 4 pulgadas por medio de `fig.height = 4`, las opciones del chunk son separadas por comas, por ejemplo:

```r 
{r, chunk-label, results='hide', fig.height=4}
```
Hay muchas opciones que por tiempo no las vamos a poder ver, no obstante, todas las opciones están en el website de su creado [Yihui Xie](https://yihui.name/knitr/options). Las más usadas son: 

1. `eval`: Evalua el chunk.
2. `echo`: Muestra el código fuente.
3. `warnings` y `message`: Permite suprimir el mensaje o bien la advertencia, se usa con `TRUE` o `FALSE`. 

Si cierta opción la necesitamos usar con frecuencia, se puede configurar globalmente:

```r
{r, setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
``` 

---

# Ejercicio 1 

A partir del código en el script ("ayudantia_1.R"), pasemoslo a Rmarkdown.

```r 
# Chunk 1 
plot(cars, pch = 18)

# Chunk 2 
knitr::include_graphics("hex-rmarkdown.png")

# Chunk 3 
knitr::kable(iris[1:5, ], caption = 'A caption')

# Chunk 4 
fit <-  lm(dist ~ speed, data = cars)
b   <-  coef(fit)
plot(cars)
abline(fit)
``` 

---

class: inverse, center, middle

# Características de un Documento PDF 

---

# Documento PDF 

Para crear un documento pdf desde R Markdown, se debe especificar `pdf_document()` en el YAML. Acá podemos usar $La\TeX$ e inclusive crear macros.

## Tabla de contenido

Para agregar la tabla de contenido con profundida:

```r
---
title: "Habits"
output:
  pdf_document:
    toc: true
    toc_depth: 2
---
```

Para enumerar las secciones usamos `number_sections: true`. Para aquellos que estén familiarizado con $La\TeX$ esto significa `\section{}` y con `false` igual a `\section*{}`

---

# Opciones de Figura

```r
---
title: "Habits"
output:
  pdf_document:
    fig_width: 7
    fig_height: 6
    fig_caption: true
---
```
# Print Data Frame

| Opción  | Descripciones                |
|---------|------------------------------|
| default | "llama" `print.data.frame()` |
| Kable   | usa `knitr::kable()`         |
| tibble  | usa `tibble::print.tbl_df()` |

Se agrega con `df_print: kable`

---

# Opciones $La\TeX$ 

| Variable                               | Descripción                                               |
|----------------------------------------|-----------------------------------------------------------|
| lang                                   | Document language code                                    |
| fontsize                               | Font size (e.g., 10pt, 11pt, or 12pt)                     |
| documentclass                          | LaTeX document class (e.g., `article`)                    |
| classoption                            | Options for documentclass (e.g., `oneside`)               |
| geometry                               | Options for geometry class (e.g., `margin=1in`)           |
| mainfont, sansfont, monofont, mathfont | Document fonts (works only with `xelatex` and `lualatex`) |
| linkcolor, urlcolor, citecolor         | Color for internal, external, and citation links          |

Van en el espacio antes del output.

---

# Paquete para citar usando $La\TeX$

Por default, cuando se cita el código pasa por `pandoc-citeproc`, que trabaja con todos los formatos. Para pdf, a veces es mejor usar paquetes de $La\TeX$, `natbib` o `biblatex`. Para usarlos 

```r
---
output:
  pdf_document:
    citation_package: natbib
---
```

Finalmente si desean quedarse con un archivo **.tex**, se usa `keep_tex: true`. 

```r 
---
title: "Habits"
output:
  pdf_document:
    keep_tex: true
---
```

---

# No todo es PDF

Existen dos *output* con R Markdown, documentos y presentaciones

* beamer_presentation
* github_document
* html_document
* ioslides_presentation
* latex_document
* md_document
* odt_document
* pdf_document
* powerpoint_presentation
* rtf_document
* slidy_presentation
* word_document

---

# Recomendaciones

Existen lo que yo denomino la trilogía de R Markdown de [Yihui Xie](https://yihui.name/en/):

1. [R Markdown: Definitive Guide](https://bookdown.org/yihui/rmarkdown/)

2. [Bookdown: Authoring Books and Technical Documents with R Markdown](https://bookdown.org/yihui/bookdown/)

3. [Blogdown: Creating Websites with R Markdown](https://bookdown.org/yihui/blogdown/)


<center>
<iframe src="https://giphy.com/embed/q1mHcB8wOCWf6" width="480" height="267" frameBorder="0" class="giphy-embed" allowFullScreen></iframe><p><a href="https://giphy.com/gifs/homer-simpson-the-simpsons-reaction-q1mHcB8wOCWf6"></a></p>
</center>

---

class: center, middle

# Muchas Gracias

<iframe src="https://giphy.com/embed/l2R0eYcNq9rJUsVAA" width="380" height="188" frameBorder="0" class="giphy-embed" allowFullScreen></iframe><p><a href="https://giphy.com/gifs/latelateshow-james-corden-late-show-l2R0eYcNq9rJUsVAA"></a></p>


Slides creadas por la librería de R [**xaringan**](https://github.com/yihui/xaringan).

El chakra proviene [remark.js](https://remarkjs.com), [**knitr**](http://yihui.name/knitr), y [R Markdown](https://rmarkdown.rstudio.com).
